# 任务

1. 完成书籍的删除

2. 完成本地书籍导入的功能。

## 书籍的删除

功能:

1. 收藏页面点击删除。
2. 删除会将下载列表中所有的记录和本地文件全部删除。
3. 当某个任务正在加载的时候无法删除，需要暂停任务，才能够删除。

首先说明，这种方式可能不太友好，关于其他方式的设计，需要等到以后再说。


基础原理:发送删除请求到任务列表中，如果任务正在等待或者加载，那么就返回说明需要先暂停任务，才能进行删除。
如果任务没有被加载，则删除存储在List中的人物，然后进行回调。回调之后，首先从Adapter中删除书籍。然后
从数据库中删除任务，删除目录，删除文件。

这里的交互都是通过RxBus实现的，感觉方式上有点问题，需要改进。(感觉实现方式太丑陋了，正确的方式应该是创建Binder)
(明天使用IBinder重构一下，马旦，脑子短路了，现在才想起来。。)

## 书籍展示系统的制作

### 智能导入书籍页面的制作。

1. 文件夹下txt文件的获取。(完成)
2. 制作Adapter (未完成) ==> Adapter为通用Adapter，传入参数为File
3. 全选点击的问题 ()

### 手机目录的制作

1. 文件显示  (完成)
2. 文件回退功能 (正在制作)

还差:

1. 在FileCategory中，当没有file的时候，全选无法点击这个功能。
2. 删除功能 (之后做)
3. 添加书籍功能需要在小说重构之后做完

# 后面的计划

重构小说加载页面，支持页码，字节大小问题，弱网环境下判断加载的问题(弱网环境下最好加载取消上次加载的功能)

一定重新思考一下需要加入那些功能，然后把主干先做出来，然后再制作其他的功能。

思考重构:

1. 从文件中获取数据的方式。(思考遗漏的东西: 文件过大的处理，文件格式的处理)
2. 获取数据进行页码转换并且缓存的方式
3. 将数据转换成页码之后设计的功能
4. 如何将状态变化加入到绘制中
5. 如何保证不过度加载(比如下两章还没有加载完成，又加载了重复章节的问题)
6. 弱网环境下，可能造成未openChapter就进行保存导致崩溃的情况
7. 如何导入大文件的本地书籍
8. 如何加入其他格式

回复:

总流程的思考:

总体假设:不考虑本地文件的问题，假设单章数据不会过载。那么该如何设计。

读取章节部分:首先假设章节已存在本地中。

流程:首先指定获取哪个文本，确定当前每页的行数目。然后获取到文件的管道，之后考虑如何加载成一页，一页需要保证缩进和换行
符占用行的问题。之后将章节转换成Page列表。并使用Cache进行缓存。开放获取Page的方法。，记录当前Page数

思考如果加入本地状态之后该怎么办。(获取章节分割，如果没有章节设定边界作为一章进行分割，通过加载下一章的时候再进行分割)

加载章节，等待部分:如何保证status与数据的结合



从文件中获取数据

需要思考的问题:
1. 文件过大的问题  (本地加载会造成的问题)
2. 文件编码的问题  (本地加载会造成的问题)
3. 使用哪种方式获取的问题
4. 如何进行缓存到内存中。

制作:

1. 首先完成使用Channel获取数据并转换成List<TPage>并使用Cache缓存。
创建openChapter方法，getNext()，和getPre()还有getPage()(自动改变页面的指针)方法。

改写PageFactory对BookManager的调用，并能够完全使用。(完成)

2.
解决PageFactory刚开始的时候如果存在弱网状态下获取不到数据，导致崩溃的情况。
(基本完成)
解决当弱网环境下点击某个章节，显示正在加载，再切换到其他章节，还是显示正在加载时候，最后加载成功，到底显示哪个页面的问题。
(基本完成)
解决当网络错误情况下，点击重新加载的问题。
(未完成)
解决当章节正在加载的时候，无法翻页，除非使用skipTo()的方式，如何处理skipTo是个问题
(基本完成)
解决setText()的调用问题(懒得解决)

解决代码的优化问题(采用异步的方法进行分页？，添加缓存文件？)
(感觉没必要)


时间改变造成正在加载、错误的变化。
修改status的绘制方式
修改网络数据传输的逻辑
页面位置存储
网络错误点击修复的事件

步骤:重新设计绘制的流程 将onStatus全部换成onDraw()